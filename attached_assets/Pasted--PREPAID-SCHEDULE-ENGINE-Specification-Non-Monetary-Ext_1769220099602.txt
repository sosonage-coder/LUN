# PREPAID SCHEDULE ENGINE

**Specification (Non-Monetary Extension)**

> Inherits from:Â Non-Monetary Schedule Engine â€“ Base Spec (v1)
> 
> 
> This document definesÂ **only prepaid-specific rules**.
> 

---

## 0ï¸âƒ£ Purpose (Prepaid-specific)

ModelÂ **prepaid expenses**Â as non-monetary schedules that:

- allocate a fixed cost over time
- recognize expense in reporting currency
- preserve visibility of local currency
- support corrections and late onboarding
- never remeasure FX
- never restate closed periods

Prepaids areÂ **finite, non-terminal schedules**:

they always complete; they never dispose.

---

## 1ï¸âƒ£ What makes Prepaids distinct (scope boundaries)

Prepaid schedules:

- âœ… Have aÂ **defined start and end date**
- âœ… AllocateÂ **100% of the basis**
- âœ… DoÂ **not**Â have salvage value
- âœ… DoÂ **not**Â have gain/loss
- âŒ DoÂ **not**Â terminate early (no disposal)
- âŒ DoÂ **not**Â change identity mid-life

If a use case violates this â†’ it isÂ **not a prepaid**.

---

## 2ï¸âƒ£ Prepaid Recognition Snapshot (extends Base Â§4.1)

### Required fields (in addition to Base)

- `start_date`Â (date)
- `end_date`Â (date)
- `total_periods`Â (derived from dates, monthly granularity)

### Derived at recognition

- `total_amount_reporting_initial`
- `total_amount_local_initial`
- `implied_fx_initial`
- `period_count_initial`

### Rules

- Dates define the schedule length.
- Amount defines the allocation base.
- FX is derived and locked.

---

## 3ï¸âƒ£ Prepaid Event Types (extends Base Â§4.2)

Prepaids supportÂ **only these event types**:

### A)Â `REBASIS_AMOUNT`

(Correction of total prepaid amount)

**Inputs**

- `new_total_reporting`Â (optional)
- `new_total_local`Â (optional)

**Rules**

- At least one amount required.
- If both supplied â†’ FX is re-derived.
- If one supplied â†’ other derived using effective FX.
- Adjustment isÂ **prospective only**.

---

### B)Â `CHANGE_DATES`

(Change to start and/or end date)

**Inputs**

- `new_start_date`Â (optional)
- `new_end_date`Â (optional)

**Rules**

- Recomputes total periods.
- Allocation recalculated in reporting currency.
- Closed periods untouched.
- Delta flows forward.

---

### C)Â `RECLASSIFICATION`Â (optional, accounting-only)

(Used when prepaid is reclassified but not remeasured)

**Inputs**

- `new_expense_account`
- `effective_period`

**Rules**

- No schedule math change.
- Posting classification only.

---

## 4ï¸âƒ£ Allocation Logic (Prepaid-specific)

### 4.1 Period generation

- Monthly periods fromÂ `start_date`Â toÂ `end_date`
- UsesÂ **FIRST_FULL_MONTH**Â convention by default

Example:

- Start: Jan 15 â†’ first amortization = Feb
- End: Dec 31 â†’ last amortization = Dec

---

### 4.2 Monthly amortization (reporting currency)

```
monthly_amortization =
  total_reporting_effective / total_periods_effective

```

- Rounded to 2 decimals per period
- Final active period usesÂ **true-up**Â to eliminate rounding drift

---

### 4.3 Local currency amounts

For each period:

```
period_local_amount =
  period_reporting_amount / effective_implied_fx

```

Local amounts are:

- displayed
- never used for posting
- never independently edited

---

## 5ï¸âƒ£ Late Onboarding (External History)

### 5.1 System posting boundary

Each prepaid may define:

- `system_posting_start_period`

Periods before this are:

- markedÂ `EXTERNAL`
- included in timeline/progress
- excluded from posting

---

### 5.2 Onboarding modes

### Default:Â `CONTINUE_ONLY`

- Prior periods assumed expensed externally
- System posts only future periods
- No catch-up entry

### Optional:Â `CATCH_UP`

- System posts cumulative difference in first open period
- Marked as adjustment
- Explicitly labeled in UI

---

## 6ï¸âƒ£ Closed Period Behavior (inherits Base Â§7)

### Immutable behavior

- Closed periods cannot be recalculated
- Any change creates aÂ **forward-only delta**

### Adjustment landing

- Delta always lands in:
    - current open period, or
    - next open period if current is closed

Marked as:

- `SYSTEM_ADJUSTED`

---

## 7ï¸âƒ£ Schedule States (Prepaid subset)

Prepaids use these Base states:

- `EXTERNAL`
- `SYSTEM_BASE`
- `SYSTEM_ADJUSTED`
- `CLOSED`

TheyÂ **never**Â use:

- `STOPPED`
- terminal states

A prepaid is complete when:

- all periods are allocated
- remaining balance = 0

---

## 8ï¸âƒ£ Posting Output (Prepaid-specific)

### Journal intent (reporting currency only)

Per eligible period:

- Dr Prepaid Expense
- Cr Prepaid Asset

Adjustments:

- Dr/Cr Prepaid Expense
- Cr/Dr Prepaid Asset

No gain/loss.

No disposal entries.

No salvage logic.

---

## 9ï¸âƒ£ UI Expectations (Prepaid-specific)

### Collapsed view

Show:

- vendor / description
- date range
- progress bar (time-based)
- monthly amortization (reporting)
- total reporting amount
- implied FX ğŸ”’
- local total (muted)

---

### Expanded view

Timeline grid:

- Row 1: Reporting currency (dominant)
- Row 2: Local currency (muted)

Pinned:

- FX @ recognition (derived)
- total periods / elapsed / remaining
- posting start period (if late onboarding)

Each adjusted period must explainÂ **why**.

---

## ğŸ”Ÿ Guardrails (Prepaid-specific)

### Always block

- Manual edits to individual periods
- FX entry or override
- Disposal logic
- Salvage value fields
- Gain/loss logic

### Warn

- FX implied out of range
- Large forward adjustments
- Date changes that materially alter period count

---

## 1ï¸âƒ£1ï¸âƒ£ What Prepaids deliberately doÂ *not*Â support

- Partial termination
- Componentization
- Balance-driven remeasurement
- Life extensions beyond end date without explicit date change
- Period-specific overrides

If users ask for these â†’ itâ€™s the wrong instrument.

---

## 1ï¸âƒ£2ï¸âƒ£ Why this works (Prepaid lens)

Because it:

- mirrors how accountantsÂ *actually*Â treat prepaids
- never lies about what the system posted
- makes corrections explicit
- makes FX visible but powerless
- treats time as the only driver

This is aÂ **schedule**, not a spreadsheet.

---

## ğŸ” Relationship to Fixed Assets

| Dimension | Prepaid | Fixed Asset |
| --- | --- | --- |
| Engine base | Non-Monetary | Non-Monetary |
| Time-bound | Yes | Often |
| Terminal event | No | Yes (disposal) |
| Salvage | No | Yes |
| Gain/loss | No | Yes |
| Components | No | Yes |

Same engine.

Different rules.

No ambiguity.